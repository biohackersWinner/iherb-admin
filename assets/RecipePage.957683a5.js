var e=Object.defineProperty,n=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(n,t,i)=>t in n?e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,a=(e,a)=>{for(var l in a||(a={}))t.call(a,l)&&r(e,l,a[l]);if(n)for(var l of n(a))i.call(a,l)&&r(e,l,a[l]);return e},l=(e,r)=>{var a={};for(var l in e)t.call(e,l)&&r.indexOf(l)<0&&(a[l]=e[l]);if(null!=e&&n)for(var l of n(e))r.indexOf(l)<0&&i.call(e,l)&&(a[l]=e[l]);return a};import{j as u,A as o,F as s,n as c,T as f,k as d,_ as p,r as m,l as v,B as h,I as g,P as b,J as y,K as w,i as x}from"./vendor.86819600.js";import{q as k}from"./index.c1cf47a9.js";import{u as E,F as V,s as I,m as O}from"./FormSelect.8f58eafe.js";import{f as j,u as A,c as C,v as q,d as F,A as R,F as $,a as S,e as z,b as L,E as N,S as P,R as T,P as D}from"./common.df3a6644.js";import{I as M,F as Q}from"./FormInput.1201506c.js";function _(e){const{name:n}=e,t=E(),{data:i,isLoading:r}=t;if(!i)return null;const a=function(e){return e.map((e=>({label:`${e.partNumber} / ${e.displayName}`,value:String(e.productId)})))}(i.list);return u(V,{name:n,options:a})}const B=[{id:"1",name:"Коронавирус",title:"Схема лечения легкой и среднетяжелой форм COVID-19",description:"С мая этого года стало появляться немало научных исследований, в которых черным по белому написано, что применение антибиотиков при коронавирусе имеет смысл в очень ограниченном количестве случаев, бактериальные осложнения нечасты. Неоправданное назначение нескольких видов антибиотиков не лучшим образом влияет на ослабленный организм, вызывая перегрузку детоксикационной, иммунной и других систем.\n\nКроме того после подобных назначений во многих ковидариях появились супербактерии, резистентные практически ко всем антибиотикам. Некоторые исследователи отметили, что тяжелобольные во многих случаях умирали от осложнений, связанных с подобными больничными инфекциями.",steps:[{name:"С первых дней заболевания",description:"Необходимо обзавестись пульсоксиметром. Если сатурация падает ниже 96, принять Гипоксен и янтарную кислоту. Если сатурация ниже 94% — необходима госпитализация.",products:[{productId:"10035",qty:"30000 МЕ",description:"в первые четыре дня заболевания, далее перейти на стандартные дозировки не менее 5000 единиц в день"},{productId:"68678",qty:"20000 МЕ",description:"в первые пять дней заболевания, далее перейти на 10 000 единиц 1 месяц (подойдёт аптечный Ретинол ацетат либо Ретинол пальмитат)"}]},{name:"Также подключить",products:[{productId:"10035",qty:"30000 МЕ",description:"в первые четыре дня заболевания, далее перейти на стандартные дозировки не менее 5000 единиц в день"}]}]},{id:"2",name:"Витамины для роста волос",description:"С мая этого года стало появляться немало научных исследований, в которых черным по белому написано, что применение антибиотиков при коронавирусе имеет смысл в очень ограниченном количестве случаев, бактериальные осложнения нечасты. Неоправданное назначение нескольких видов антибиотиков не лучшим образом влияет на ослабленный организм, вызывая перегрузку детоксикационной, иммунной и других систем.\n\nКроме того после подобных назначений во многих ковидариях появились супербактерии, резистентные практически ко всем антибиотикам. Некоторые исследователи отметили, что тяжелобольные во многих случаях умирали от осложнений, связанных с подобными больничными инфекциями.",steps:[{name:"С утра натощак",products:[{productId:"10035",qty:"30000 МЕ",description:"в первые четыре дня заболевания, далее перейти на стандартные дозировки не менее 5000 единиц в день"},{productId:"68678",qty:"20000 МЕ",description:"в первые пять дней заболевания, далее перейти на 10 000 единиц 1 месяц (подойдёт аптечный Ретинол ацетат либо Ретинол пальмитат)"}]},{name:"За завтраком, содержащим жиры",products:[{productId:"10035",qty:"30000 МЕ",description:"в первые четыре дня заболевания, далее перейти на стандартные дозировки не менее 5000 единиц в день"}]}]}];async function K(){return H(await async function(){return await I(),B}())}function J(){return o("RecipeList",K,{staleTime:1/0})}function W(){return s((e=>async function(e){return await I(),null}()),{onMutate:async e=>{k.setQueryData("RecipeList",(n=>H(n?[...n.list,e]:[e])))}})}function Y(){return s((e=>async function(e){return await I(),null}()),{onMutate:async e=>{k.setQueryData("RecipeList",(n=>H(n.list.map((n=>n.id===e.id?e:n)))))}})}function G(){return s((e=>async function(e){return await I(),null}(e.id)),{onMutate:async e=>{k.setQueryData("RecipeList",(n=>H(n.list.filter((n=>n.id!==e.id)))))}})}function H(e){return{list:e,map:O(e)}}const U=c.div`
  display: flex;
  margin-bottom: 20px;
  align-items: center;
`,X=c.div`
  margin-right: 16px;
  width: 150px;
`,Z=c.div`
  flex-grow: 1;
`,ee=c.div`
  margin-bottom: 12px;
  padding: 20px;
  border: 1px solid #ccc;
`,ne=c.div`
  display: flex;
`,te=c.div`
  margin-bottom: 24px;
  border-bottom: 1px solid #ccc;
`,ie=c.div`
  display: flex;
  align-items: center;
  margin-bottom: 20px;
`,re=c.div`
  width: 150px;
`,ae=c.div`
  flex-grow: 1;
`,le=c.div`
  width: 150px;
`,ue=c.div`
  text-align: right;
`,oe=c.div`
  margin-left: 150px;
`,se=c.div`
  margin-left: 170px;
`,ce=c.div`
  .ant-table-row {
    cursor: pointer;
  }
`,fe=[{title:"Название",dataIndex:"name",key:"name"},{title:"Заголовок",dataIndex:"title",key:"title"}];function de(e){const{onRowClick:n}=e,t=J(),{data:i,isLoading:r}=t;return u(ce,null,u(f,{dataSource:null==i?void 0:i.list,columns:fe,loading:r,size:"middle",rowKey:"id",pagination:!1,onRow:function(e){return{onClick:()=>n(e)}}}))}var pe=function(e,n){return e===n||Array.isArray(e)&&Array.isArray(n)&&e.length===n.length&&!e.some((function(e,t){return e!==n[t]}))};function me(e){var n=v.useRef();return n.current||(n.current=e()),n.current}var ve=j.reduce((function(e,n){return e[n]=!0,e}),{}),he={"final-form":q,"react-final-form":F,"react-final-form-arrays":"3.1.2"},ge=function(e){var n=e.name,t=e.subscription,i=e.defaultValue,r=e.initialValue,a=e.isEqual,l=e.validate,u=d(e,["name","subscription","defaultValue","initialValue","isEqual","validate"]),o=function(e,n){var t=void 0===n?{}:n,i=t.subscription,r=void 0===i?ve:i,a=t.defaultValue,l=t.initialValue,u=t.isEqual,o=void 0===u?pe:u,s=t.validate,c=A("useFieldArray").mutators;if(!(c&&c.push&&c.pop))throw new Error("Array mutators not found. You need to provide the mutators from final-form-arrays to your form");var f=me((function(){return Object.keys(c).reduce((function(n,t){return n[t]=function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return c[t].apply(c,[e].concat(i))},n}),{})})),m=me((function(){return function(e,n,t){if(s){var i=s(e,n,t);if(!i||Array.isArray(i))return i;var r=[];return r[R]=i,r}}})),v=C(e,{subscription:p({},r,{length:!0}),defaultValue:a,initialValue:l,isEqual:o,validate:m,format:function(e){return e}}),h=v.meta,g=h.length,b=d(h,["length"]),y=v.input,w=d(v,["meta","input"]);return{fields:p({name:e,forEach:function(n){for(var t=g||0,i=0;i<t;i++)n(e+"["+i+"]",i)},length:g||0,map:function(n){for(var t=g||0,i=[],r=0;r<t;r++)i.push(n(e+"["+r+"]",r));return i}},f,w,{value:y.value}),meta:b}}(n,{subscription:t,defaultValue:i,initialValue:r,isEqual:a,validate:l}),s=o.fields,c=o.meta;return function(e,n){var t=e.render,i=e.children,r=e.component,a=d(e,["render","children","component"]);if(r)return m.exports.createElement(r,p({},a,{children:i,render:t}));if(t)return t(void 0===i?a:p({},a,{children:i}));if("function"!=typeof i)throw new Error("Must specify either a render prop, a render function as children, or a component prop to "+n);return i(a)}(p({fields:s,meta:p({},c,{__versions:he})},u),"FieldArray("+n+")")};function be(){return(be=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)}function ye(e,n,t,i){void 0===i&&(i=e),delete e.fields[n.name],e.fields[t]=be({},n,{name:t,change:i.fields[t]&&i.fields[t].change,blur:i.fields[t]&&i.fields[t].blur,focus:i.fields[t]&&i.fields[t].focus,lastFieldState:void 0}),e.fields[t].change||delete e.fields[t].change,e.fields[t].blur||delete e.fields[t].blur,e.fields[t].focus||delete e.fields[t].focus}var we=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},xe=function(e,n,t){var i=e[0],r=e[1],a=e[2],l=t.changeValue;t.resetFieldState,l(n,i,(function(e){var n=[].concat(e||[]);return n.splice(r,0,a),n}));var u=be({},n.fields),o=new RegExp("^"+we(i)+"\\[(\\d+)\\](.*)");Object.keys(n.fields).sort().reverse().forEach((function(e){var t=o.exec(e);if(t){var a=Number(t[1]);if(a>=r){var l=i+"["+(a+1)+"]"+t[2];ye(n,u[e],l)}}}))};function ke(e,n,t,i){Object.keys(i.fields).forEach((function(r){if(r.substring(0,n.length)===n){var a=r.substring(n.length),l=e+"["+t+"]"+a;ye(i,i.fields[r],l)}}))}function Ee(e,n){Object.keys(e.fields).forEach((function(t){e.fields[t]=be({},e.fields[t],{change:e.fields[t].change||n.fields[t]&&n.fields[t].change,blur:e.fields[t].blur||n.fields[t]&&n.fields[t].blur,focus:e.fields[t].focus||n.fields[t]&&n.fields[t].focus}),e.fields[t].change||delete e.fields[t].change,e.fields[t].blur||delete e.fields[t].blur,e.fields[t].focus||delete e.fields[t].focus}))}var Ve=function(e,n,t){var i,r=e[0],a=e[1],l=t.changeValue,u=t.renameField;l(n,r,(function(e){var n=[].concat(e||[]);return i=n[a],n.splice(a,1),n}));var o=new RegExp("^"+we(r)+"\\[(\\d+)\\](.*)"),s=be({},n,{fields:be({},n.fields)});return Object.keys(n.fields).forEach((function(e){var t=o.exec(e);if(t){var i=Number(t[1]);if(i===a)delete n.fields[e];else if(i>a){delete n.fields[e];var l=r+"["+(i-1)+"]"+t[2];s.fields[l]?ye(n,s.fields[e],l,s):u(n,e,l)}}})),i},Ie={insert:xe,concat:function(e,n,t){var i=e[0],r=e[1];(0,t.changeValue)(n,i,(function(e){return e?[].concat(e,r):r}))},move:function(e,n,t){var i=e[0],r=e[1],a=e[2],l=t.changeValue;if(r!==a){l(n,i,(function(e){var n=[].concat(e||[]),t=n[r];return n.splice(r,1),n.splice(a,0,t),n}));var u=be({},n,{fields:be({},n.fields)});if(ke(i,i+"["+r+"]","tmp",n),r<a)for(var o=r+1;o<=a;o++){ke(i,i+"["+o+"]",""+(o-1),n)}else for(var s=r-1;s>=a;s--){ke(i,i+"["+s+"]",""+(s+1),n)}ke(i,i+"[tmp]",a,n),Ee(n,u)}},pop:function(e,n,t){var i,r,a=e[0];if((0,t.changeValue)(n,a,(function(e){if(e)return e.length?(r=e.length-1,i=e[r],e.slice(0,r)):[]})),void 0!==r){var l=new RegExp("^"+we(a)+"\\["+r+"].*");Object.keys(n.fields).forEach((function(e){l.test(e)&&delete n.fields[e]}))}return i},push:function(e,n,t){var i=e[0],r=e[1];(0,t.changeValue)(n,i,(function(e){return e?[].concat(e,[r]):[r]}))},remove:Ve,removeBatch:function(e,n,t){var i=e[0],r=e[1],a=t.changeValue,l=[].concat(r);l.sort();for(var u=0;u<l.length;u++)u>0&&l[u]===l[u-1]&&l.splice(u--,1);var o=[];a(n,i,(function(e){if(o=r.map((function(n){return e&&e[n]})),!e||!l.length)return e;var n=[].concat(e),t=[];return l.forEach((function(i){n.splice(i-t.length,1),t.push(e&&e[i])})),n}));var s=new RegExp("^"+we(i)+"\\[(\\d+)\\](.*)"),c=be({},n,{fields:{}});return Object.keys(n.fields).forEach((function(e){var t,r=s.exec(e);if(r){var a=Number(r[1]);if(!~l.indexOf(a)){var u=i+"["+(a-(t=a,l.reduce((function(e,n){return n<t?e+1:e}),0)))+"]"+r[2];ye(c,n.fields[e],u,n)}}else c.fields[e]=n.fields[e]})),n.fields=c.fields,o},shift:function(e,n,t){var i=e[0];return Ve([i,0],n,t)},swap:function(e,n,t){var i=e[0],r=e[1],a=e[2],l=t.changeValue;if(r!==a){l(n,i,(function(e){var n=[].concat(e||[]),t=n[r];return n[r]=n[a],n[a]=t,n}));var u=be({},n,{fields:be({},n.fields)}),o=i+"["+a+"]",s=i+"[tmp]";ke(i,i+"["+r+"]","tmp",n),ke(i,o,r,n),ke(i,s,a,n),Ee(n,u)}},unshift:function(e,n,t){var i=e[0],r=e[1];return xe([i,0,r],n,t)},update:function(e,n,t){var i=e[0],r=e[1],a=e[2];(0,t.changeValue)(n,i,(function(e){var n=[].concat(e||[]);return n.splice(r,1,a),n}))}};function Oe(e){const{label:n,value:t,labelWidth:i,align:r}=e;return u($,null,u(S,{width:i,align:r},n),u(z,null,t))}const je=c.div`
  position: relative;
`;function Ae(e){const n=e,{name:t,errorAbsolute:i}=n,r=l(n,["name","errorAbsolute"]);return u(L,{name:t},(({input:e,meta:n})=>{const{touched:t,error:l,submitError:o}=n,s=!(t&&l||o),c=s?null:o||l;return u(je,{className:s?"":"has-error"},u(M.TextArea,a(a({},e),r)),c&&u(N,{absolute:i},c))}))}function Ce(e){const{name:n}=e;return u(ne,null,u(re,null,"Продукты"),u(ae,null,u(ge,{name:n},(({fields:e})=>{const n=!!e.value[e.value.length-1];return u(v.Fragment,null,e.map(((n,t)=>u(te,{key:t},u(Oe,{label:"Продукт",value:u(_,{name:`${n}.productId`})}),u(Oe,{label:"Описание",value:u(Ae,{name:`${n}.description`})}),u(Oe,{label:"Кол-во",value:u(le,null,u(Q,{name:`${n}.qty`}))}),e.length&&e.length>1&&u(Oe,{label:"",value:u(h,{onClick:()=>e.remove(t)},u(g,null),"Удалить продукт")})))),n&&u(ue,null,u(h,{onClick:()=>e.push(void 0)},u(b,null),"Добавить продукт")))}))))}function qe(){return u("div",null,"Шаги",u(P,{height:8}),u(ge,{name:"steps"},(({fields:e})=>{const n=!!e.value[e.value.length-1];return u(v.Fragment,null,e.map(((n,t)=>u(ee,{key:t},u(ie,null,u(re,null,"Название"),u(ae,null,u(Q,{name:`${n}.name`}))),u(ie,null,u(re,null,"Описание"),u(ae,null,u(Ae,{name:`${n}.description`}))),u(Ce,{name:`${n}.products`}),e.length&&e.length>1&&u(oe,null,u(h,{onClick:()=>e.remove(t)},u(g,null),"Удалить шаг"))))),n&&u(ue,null,u(h,{onClick:()=>e.push({name:void 0,products:[void 0]})},u(b,null),"Добавить шаг")))})))}function Fe(e){const{recipeId:n,close:t}=e,i=J(),r=Y(),o=G(),s=W();const{data:c,isLoading:f}=i;if(!c)return null;const d="new"===n,p=n&&!d?c.map[n]:null;return u("div",null,u(T,{initialValues:p||{name:"",steps:[{name:void 0,products:[void 0]}]},onSubmit:async function(e){const n=e,{action:i}=n,a=l(n,["action"]);"remove"===i?await o.mutate(a):"create"===i?await s.mutate(a):await r.mutate(a),null==t||t()},mutators:a({},Ie),render:({handleSubmit:e,form:n,submitting:i})=>u("form",{onSubmit:async t=>{await e(t),n.reset()}},u(U,null,u(X,null,"Название"),u(Z,null,u(Q,{name:"name",size:"large"}))),u(U,null,u(X,null,"Заголовок"),u(Z,null,u(Q,{name:"title",size:"large"}))),u(U,null,u(X,null,"Описание"),u(Z,null,u(Ae,{name:"description",size:"large"}))),u(P,{height:20}),u(qe,null),u(L,{name:"action",subscription:{value:!0}},(({input:{value:r}})=>u(se,null,u(h,{type:"primary",htmlType:"submit",disabled:i,loading:"remove"!==r&&i,size:"large",onClick:()=>{n.change("action",d?"create":"update")}},"Сохранить"),u(P,{width:20,inline:!0}),!d&&u(h,{danger:!0,disabled:i,htmlType:"button",loading:"remove"===r&&i,size:"large",onClick:()=>{n.change("action","remove"),e()}},"Удалить"),u(P,{width:20,inline:!0}),u(h,{size:"large",onClick:()=>{n.reset(),null==t||t()}},"Отмена")))))}))}function Re(e){const{recipeId:n,isVisible:t,onClose:i}=e;return u(y,{title:("new"===n?"Создание":"Редактирование")+" схемы",visible:t,width:1e3,onClose:i},t&&u(Fe,{recipeId:n,close:i}))}function $e(){const{recipeId:e}=w(),n=x();return u("div",null,u(D,null,u("h1",null,"Схемы"),u(P,{width:20}),u(h,{onClick:function(){n.push("/recipes/new")},icon:u(b,null)},"Добавить")),u(de,{onRowClick:function(e){n.push(`/recipes/${e.id}`)}}),u(Re,{isVisible:!!e,onClose:function(){n.push("/recipes/")},recipeId:e}))}export default $e;
